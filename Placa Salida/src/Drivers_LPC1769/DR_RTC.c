/*******************************************************************************************************************************//**
 	\file DR_RTC.c
 	\brief Drivers de PWM
 	\details Trabajo Practico Obligatorio
 	\author Marcos Trautman, Alan Kinast
 	\date 2016.11.25
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "DR_RTC.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
uint32_t f_tick_rtc=0;
/***********************************************************************************************************************************
 *** VARIABLES GLOBLES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/

/**
	\fn void Inic_RTC(void)
	\brief Inicializacion del RTC
 	\param void
	\return void
	\author Alan Kinast, Marcos Trautman
 	\date 2016.11.25
*/
void Inic_RTC(void)
{
	RTCILR = 0x00;				//!< Limpio Flags
	RTCCIIR = 0x00;				//!< Deshabilito interrupciones
	RTCAMR = 0xFF;				//!< Enmascaro comparador de alarmas
	RTCCALIBRATION = 0x00;		//!< Inicializa registro de calibración
	RTCCCR = 0x01;				//!< Arranca contador
}

/**
	\fn void RTC_HabilitaInterrupcion(uint32_t tipo_int)
	\brief Inicializacion de interrupción del RTC
 	\param [in] uint32_t tipo_int (Indica causa de la interrupción)
	\return void
	\author Alan Kinast, Marcos Trautman
 	\date 2016.11.25
*/

void RTC_HabilitaInterrupcion(uint32_t tipo_int)
{
	RTCCIIR |= 1<< tipo_int;	//se habilita el tipo de interrupcion pedido (MODIFICO CADA CUANTO QUIERO QUE ME INTERRUMPA
	//								1 SEGUNDOS 10 MINUTOS 100 HORAS 1000 DIAS
	RTCILR = 0x03;				//limpio flags de interrupcion
	ISER0 |= 1<<17;				//habilito interrupcion desde el NVIC
}




/**
	\fn void RTC_IRQHandler(void)
	\brief Handler del RTC
 	\param
	\return void
	\author Alan Kinast, Marcos Trautman
 	\date 2016.11.25
*/


void RTC_IRQHandler(void)
{
	RTCILR |= 0xFF;		//!<limpio todos los flags de interrupcion
	f_tick_rtc = 1;
}
