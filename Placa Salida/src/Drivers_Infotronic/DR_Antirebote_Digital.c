
/*******************************************************************************************************************************//**
 	\file DR_Antirebote_Digital.c
 	\brief Drivers de entradas digitales y teclado no monotecla placa base
 	\details Trabajo Practico Obligatorio
 	\author Marcos Trautman, Alan Kinast
 	\date 2016.11.25
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "DR_Antirebote_Digital.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
uint8_t Buffer_Debounce;
/***********************************************************************************************************************************
 *** VARIABLES GLOBLES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/

/**
	\fn  void debounce (void)
	\brief Driver de entradas digitales y teclado placa base con proteccion antirebote
 	\details
 	\author Alan Kinast, Marcos Trautman
 	\date 2016.11.25
*/
void debounce (void)
{
	static uint8_t ContEstados[ENTRADAS];
	uint8_t in=0,i;
	if(!GetPIN(KEY0,ALTO))
	{
		in=in|0x01;//activo BAJO, apretar me induce un cero
	}
	if(!GetPIN(KEY1,ALTO))
	{
		in=in|0x02;
	}
	if(!GetPIN(KEY2,ALTO))
	{
		in=in|0x04;
	}
	if(!GetPIN(KEY3,ALTO))
	{
		in=in|0x08;
	}
	if(!GetPIN(KEY4,ALTO))
	{
		in=in|0x10;
	}

	in=in^Buffer_Debounce;//Si es distinto al buffer me pone un 1, si es igual un cero, pq es una xor

	if(!in)//if(in==0)
	{
		for(i=0;i<ENTRADAS;i++)
			ContEstados[i]=0;
	}
	else
	{
		for(i=0;i<ENTRADAS;i++)
		{
			if(in&(1<<i))
			{
				ContEstados[i]++;
				if(ContEstados[i]>=EstadosEstables)
				{
					Buffer_Debounce=Buffer_Debounce^(1<<i);
				}
			}
			else
			{
				ContEstados[i]=0;
			}
		}
	}
}

