
/*******************************************************************************************************************************//**
 	\file DR_EntradaDigital.c
 	\brief Drivers de entradas digitales externas
 	\details Trabajo Practico Obligatorio
 	\author Marcos Trautman, Alan Kinast
 	\date 2016.11.25
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "DR_EntradaDigital.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
uint8_t Buffer_Debounce_Digital;//!< Buffer de entradas digitales
/***********************************************************************************************************************************
 *** VARIABLES GLOBLES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/

/**
	\fn  void Inicializacion_EntradasDigitales (void)
	\brief Inicializacion de entradas digitales
 	\details
 	\author Alan Kinast, Marcos Trautman
 	\date 2016.11.25
*/
void Inicializacion_EntradasDigitales (void)
{
	SetPINSEL ( 4,29  , FUNCION_GPIO );
	SetPINSEL ( 2,11 , FUNCION_GPIO );

	SetDIR (  4,29 , ENTRADA );
	SetDIR ( 2,11 , ENTRADA );

	SetMODE (  4,29  , PULLUP );//Es pull-up por que es activo bajo
	SetMODE ( 2,11 , PULLUP );
}


/**
	\fn  uint8_t Buffer_Debounce_Digital;
	\brief Driver con antirebote de las entradas digitales
 	\details
 	\author Alan Kinast, Marcos Trautman
 	\date 2016.11.25
*/

void debounce_EntradaDigital (void)
{
	static uint8_t ContEstados[ENTRADAS_DIGITAL];//2 entradas
	uint8_t in=0,i;
	if(!GetPIN(4,29,ALTO))
	{
		in=in|0x01;//activo BAJO, apretar me induce un cero
	}
	if(!GetPIN(2,11,ALTO))
	{
		in=in|0x02;
	}

	in=in^Buffer_Debounce_Digital;//Si es distinto al buffer me pone un 1, si es igual un cero, pq es una xor

	if(!in)//if(in==0)
	{
		for(i=0;i<ENTRADAS_DIGITAL;i++)
			ContEstados[i]=0;
	}
	else
	{
		for(i=0;i<ENTRADAS_DIGITAL;i++)
		{
			if(in&(1<<i))
			{
				ContEstados[i]++;
				if(ContEstados[i]>=EstadosEstables_Digital)
				{
					Buffer_Debounce_Digital=Buffer_Debounce_Digital^(1<<i);
				}
			}
			else
			{
				ContEstados[i]=0;
			}
		}
	}
}
